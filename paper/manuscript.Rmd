---
title: "Functional trait data tell new story about biodiversity change"
author: 
  - name: "Kari E A Norman"
    affiliation: ucb
  - name: "Carl Boettiger"
    affiliation: ucb, ropensci
address:
  - code: ucb
    address: "Dept of Environmental Science, Policy, and Management, University of California Berkeley, Berkeley CA 94720-3114, USA"
  - code: ropensci
    address: "The rOpenSci Project, University of California Berkeley, Berkeley CA 94720-3114, USA" 
abstract: |

journal: "Ecography"
date: "`r Sys.Date()`"
bibliography: refs.bib
layout: 3p
header-includes:
   - \usepackage{lineno}
   - \linenumbers
output: word_document
  #rticles::elsevier_article:
   # includes:
    #  in_header: preamble.tex
editor_options: 
  markdown: 
    wrap: 72
---

### Introduction

Ecological communities are experiencing unprecedented change as a result
of anthropogenic pressures such as climate change, land use change, and
invasive species. Impacts of these pressures are well documented at a
global scale by an accelerating global extinction rate [@barnosky2011],
and fundamental changes in some of the well-studied systems (e.g. coral
bleaching). At the local scale however, species diversity tells a
different story. Recent synthesis of local trends in biodiversity over
time have found no net change in local biodiversity despite ongoing
species turnover [@brown2001; @dornelas2014; @vellend2013; @vellend2017]
and evidence of a decoupling of community composition from richness
[@brose2016; [@gotelli2017]. While communities are clearly changing, our
most common species-based approaches do not fully capture the nature of
that change.

Functional diversity offers a potentially powerful alternative for
detecting and describing community change by providing a mechanistic
link between the organisms in a system and the processes they perform
[@mcgill2006]. By summarizing functional traits rather than species,
functional diversity metrics capture the disproportionate impact of
losses or gains of functionally unique species. Functional diversity
metrics are particularly suited for understanding community-level
biodiversity patterns as they can detect shifts in community structure
independent of species change.

Functional diversity sheds further light on critical ecosystem and
community processes potentially impacted by anthropogenic change. For
example, there is increasing evidence that functional diversity is a
better predictor of ecosystem function than species-based metrics
[@cadotte2011; @gagic2015], and that different facets of functional
diversity also play a role in maintaining ecosystem stability
[@craven2018; @morin2014]. Further, biogeographic assessments of
functional diversity give foundational insight into how community
assembly plays out across systems at a standardized scale [@violle2014;
@weiher2011].

<!-- What can we say about how global change is impacting:stability, resilience, function, assembly, ecosystem processes (and ecosystem services) - need a functional grounding for all those concepts. Link specific patterns in FD metrics to impacts on those concepts. -->

Assessments of broad-scale temporal change in functional diversity have
previously been limited by a lack of functional trait data. The majority
of work has therefore focused largely on system-specific studies with
traits collected *in situ*. Ongoing efforts to assemble functional
traits for a variety of taxa have made synthesis of existing community
assemblage data and functional traits possible for the first time,
providing initial looks at how functional diversity changes on a
broad-scale for specific taxa [@trindade-santos2020; @jarzyna2016;
@barnagaud2017].
<!-- so what do these studies say? does that go here? --> However, to
date there has been no cross-taxa assessment of functional change
through time on a broad geographic and taxonomic extent.\

Here we perform the first multitaxa, multisystem assessment of
functional diversity change through time. We assess 100's of mammal,
bird, and amphibian functional diversity timeseries to 1) determine how
functional diversity change compares to species change and 2) identify 3
distinct types of functional change common across communities.

### Methods

#### *Data*

We obtained mammal, bird, and amphibian timeseries from the Biotime
database, a global repository of high quality community assemblage
timeseries. All studies included in the database follow consistent
sampling protocols and represent full assemblages rather than
population-level data [@dornelas2018]. Following best practices for the
database [@blowes2019] studies with multiple sample locations were split
into individual timeseries following a standardized scale. A global grid
was defined with a cell size determined based on the sample extent of
studies with only a single location (see [@dornelas2018] for details on
how sample extents were defined), with the area of each cell set to one
standard deviation away from the mean of the single extent locations.
All samples from a study within a single cell were considered to be a
single timeseries, and species abundances were combined for all samples.

We gathered trait data from the Elton Trait Database (mammals and birds;
[@wilman2014]) and Amphibio (amphibians, [@oliveira2017]). These
databases include species-level means for traits that best define
species' function in the community including body size, diet, and
behavioral characteristics <!-- what's in the amphibian database? -->.
For the full list of traits included in the analysis see the
supplemental materials.

In order to ensure taxonomic consistency across datasets, Biotime
species were paired with trait data based on their species identifier
from the Integrated Taxonomic Information System database (citation),
obtained through the taxadb R package [@norman2020]. If more than one
species in the assemblage data resolved to the same identifier,
observations were considered the same species. For trait data, traits
for all species of the same identifier were averaged. Only studies with
at least 85% trait coverage were included. In order to have a sufficient
number of species to calculate functional diversity metrics years with
fewer than 4 species observed were excluded.

Many studies had a variable number of samples within years. To adjust
for this inconsistency in sampling effort we used sample-based
rarefaction by bootstrap resampling within years for each timeseries
based on the smallest number of samples in a year for that timeseries.

#### *Functional diversity metrics*

We calculated yearly metrics of functional diversity and turnover for
each timeseries within each study. All available trait data for each
study was included in the trait matrix with the exception of traits that
were the same value for all observed species in the study. All
continuous traits were z-score scaled to give each trait equal weight in
the trait space [@leps2006; @schleuter2010]. We also calculated basic
species richness, *S.*

We used the function dbFD from the FD package (citation) to calculated
functional diversity (FD), functional evenness (FEve), functional
diveregence (FDiv), and functional dispersion (FDis). The number of
trait axes was limited to the maximum number of traits that fulfills the
criteria $s >= s^t$, where $s$ is the number of species and \$t\$ is the
number of traits. This restriction allows for a sufficient number of
axes to capture the trait space while maintaining computational
feasibility for metric calculations. Metrics incorporated weighting
based on either species abundance or biomass based on the methods for
each study.

#### ***Null Models***

In order to control for changes in functional diversity metrics due to
species richness, we calculated the standardized effect size (SES) for
each metric from null estimates [@swenson2012]. For each richness level
observed in a timeseries, our null model randomly selected the same
number of species from the species pool, which included all species
observed over the course of the timeseries. We then randomly assigned
abundances from the original sample to each species, and all functional
diversity metrics were calculated. This process was repeated 500 times
to get a estimate and standard deviation of the null expectation for the
metric for that timeseries at that richness level. We used these values
to calculated SES using the following formula:
$SES = [F_{obs} - mean_{(F_{null})}]/SD_{(F_{null})}$.

#### *Analysis*

We modeled each diversity metric using a Linear Mixed Effects model with
a random slope and intercept for year and a nested random effect of
timeseries nested within study.
